<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IPS Portal - Run {{ run.runid }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script type="text/javascript" charset="utf8" src="{{ url_for('static', filename='event-table.js') }}" defer></script>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
	<div class="navbar-brand">IPS Portal</div>
	<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
	  <span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse" id="navbarNav">
	  <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="/">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://ips-framework.readthedocs.io/en/latest/user_guides/portal_guides.html">Documentation</a>
            </li>
	  </ul>
	</div>
      </div>
    </nav>

    <div class="container-fluid">
      <header class="py-3">
	<h4>Run {{ run.runid }}</h4>
      </header>
    </div>

    <main class="container-fluid">
      <section class="content">

	<table class="table table-sm table-primary table-bordered" style="width:50%">
	  <tbody>
	    <tr>
	      <th>User</th>
	      <td>{{ run.user }}</td>
	    </tr>
	    <tr>
	      <th>Host</th>
	      <td>{{ run.host }}</td>
	    </tr>
	    <tr>
	      <th>State</th>
	      <td>{{ run.state }}</td>
	    </tr>
	    <tr>
	      <th>Comment</th>
	      <td>{{ run.rcomment }}</td>
	    </tr>
	    <tr>
	      <th>Tokamak</th>
	      <td>{{ run.tokamak }}</td>
	    </tr>
	    <tr>
	      <th>Shot No.</th>
	      <td>{{ run.shotno }}</td>
	    </tr>
	    <tr>
	      <th>Sim Name</th>
	      <td>{{ run.simname }}</td>
	    </tr>
	    <tr>
	      <th>Start At</th>
	      <td>{{ run.startat }}</td>
	    </tr>
	    <tr>
	      <th>Stop At</th>
	      <td>{{ run.stopat }}</td>
	    </tr>
	    <tr>
	      <th>Sim Run ID</th>
	      <td>{{ run.sim_runid }}</td>
	    </tr>
	    <tr>
	      <th>Output Prefix</th>
	      <td>{{ run.outputprefix }}</td>
	    </tr>
	    <tr>
	      <th>Tag</th>
	      <td>{{ run.tag }}</td>
	    </tr>
	    <tr>
	      <th>IPS version</th>
	      <td>{{ run.ips_version }}</td>
	    </tr>
	    <tr>
	      <th>Trace</th>
	      {% if run.state == "Completed" %}
	      {% if run.has_trace %}
	      <td><a href="{{ url_for('trace.gettrace', runid=run.runid) }}">trace</a></td>
	      {% else %}
	      <td>no trace information available</td>
	      {% endif %}
	      {% else %}
	      <td>wait for run to finish</td>
	      {% endif %}
	    </tr>
	    <tr>
	      <th>Resource usage</th>
	      {% if run.state == "Completed" %}
	      {% if run.has_trace %}
	      <td><a href="{{ url_for('resourceplot.resource_plot', runid=run.runid) }}">plot</a></td>
	      {% else %}
	      <td>no trace information available</td>
	      {% endif %}
	      {% else %}
	      <td>wait for run to finish</td>
	      {% endif %}
	    </tr>
	  </tbody>
	</table>
	<h4>Events</h4>
	<div class="table-responsive">
	  <table id="event-table" class="table table-striped table-secondary table-bordered" style="width:100%" runid={{ run.runid }}>
	    <thead>
	      <tr>
		<th>Time</th>
		<th>Seq Num</th>
		<th>Event Type</th>
		<th>Code</th>
		<th>Walltime</th>
		<th>Physics Time</th>
		<th>Comment</th>
	      </tr>
	    </thead>
	    <tbody>
	    </tbody>
	  </table>
	</div>
      </section>
    </main>
  </body>
</html>
